

## 以太坊特点

- 执行称为智能合约(smart contract)的程序
- 本质是一个基于交易的状态机(transaction-based state machine)
- 以名为以太币(ether)的加密货币，来计量和约束执行资源成本

## 以太坊的组成成分

- P2P网络

  以太坊在以太坊主网络上运行，该网络可在TCP端口30303上寻址，并运行一个DEVp2p的协议。

- 交易(Transaction)

  以太坊交易是网络消息，其中包括发送者(sender),接受者(receiver),值(value)和数据的有效载荷(payload)。

- 以太坊虚拟机(EVM)

  以太坊状态转换由以太坊虚拟机(EVM)处理，这是一个执行字节码(机器语言指令)的基于堆栈的虚拟机。

- 数据库(Blockchain)

  以太坊的区块链作为数据库本地存储在每个节点上，包含序列化后的交易和系统状态。

- 客户端

  以太坊有几种可互操作的客户端软件实现，其中最突出的是Go-Ethereum和Parity

## 以太坊中的重要概念

- 账户(Account)

  包含地址，余额和随机数，以及可选的存储和代码对象。

  - 普通账户(EOA, External owner account) 

    存储和代码均为空

  - 合约账户(Contract)

    包含存储和代码

- 地址(Address)

  一般来说，这代表一个EOA或合约。具体来说，它是ECDSA公钥的keccak散列的最右边的160位。

- 交易(Transaction)

  - 可以发送以太币和消息
  - 向合约发送的交易可以调用合约代码，并以信息数据为函数参数
  - 向空用户发送消息，可以自动生成以消息为代码块的合约账户

- gas

  以太坊用于执行智能合约的虚拟燃料。以太坊虚拟机使用核算机制来衡量gas的消耗量并限制计算资源的消耗。



## 以太坊的货币

以太坊的货币单位称为(ether).

- 以太坊产量未来的变化

  PoW消耗资源过多。

  以太坊出块机制从工作量证明(PoW)转换为股权证明(PoS)后，有什么变化尚未有定论。股权证明机制将使用一个称为Casper的协议。在Casper协议下，以太币的发行率将大大低于目前幽灵(GHOST)协议下的发行率。



> 以太坊的挖矿产出

- 区块奖励(Block rewards)

- 叔块奖励(Uncle rewards)

  有些区块被挖得稍微晚一些，因此不能作为主区块的组成部分。比特币将这类区块称为“孤块”，并且完全舍弃它们。但是，以太币称它们为"叔块"(uncles),并且在之后的区块中，可以引用它们。 如果叔块在之后的区块链中作为叔块被引用。每个叔块会为挖矿者产出区块奖励的7/8。这被称之为叔块奖励。

- 叔块引用奖励(Uncle referencing rewards)

  矿工每引用一个叔块，可以获得区块奖励的1/32作为奖励(最多引用两个叔块)

  

- 这样的一套基于POW的奖励机制，被称为以太坊的“幽灵协议”



> 以太坊区块收入

- 普通区块收入

  - 固定奖励(挖矿奖励)，每个普通区块都有
  - 区块内包含的所有程序的gas花费的总和
  - 如果普通区块引用了叔块，每引用一个叔块可以得到固定奖励的1/32

- 叔块收入

  叔块收入只有一项，就是叔块奖励，计算公式为：

  叔块奖励 = (叔块高度+8-引用叔块高度)*普通区块奖励/8



## 幽灵(GHOST)协议

> 协议出现背景

12秒出块时间带来的问题： 网络传输假如5秒，算力有优势的节点占绝对优势！！！ 抢跑了网络传输时间。导致中心化！

> 协议具体

-  以太坊出块数据：设计为12秒，实际14-15秒左右
- 快速确认会带来区块的高作废率，由此链的安全性也会降低
- “幽灵”协议：Greedy Heaviest Observed SubTree.
  - 计算工作量证明时，不仅包括当前区块的祖区块，父区块，还要包括祖先块的后代区块("叔块")，将他们进行综合考虑。
  - 目前的协议要求下探到第七层(最早的简版设计是五层)，也就是说，废区块只能以叔区块的身份被其父母的第二代至第七代后辈区块引用，而不能是更远关系的后代区块。



## 名词解释

- EIP：Ethereum Improvement Proposals
- ERC: Ethereum Request for Comments
- EOA: External Owned Account
- Ethash: 以太坊1.0的工作量证明算法
- HD钱包：使用分层确定性(HD protocol)密钥创建和转账协议(BIP32)的钱包。
- Keccak256:以太坊中使用的密码哈希函数。Keccak256被标准化为SHA-3







